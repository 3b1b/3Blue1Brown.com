{{- if hasPrefix .source "http" -}}
  {{- .source | safeURL -}}
{{- else if $resource := .context.Page.Resources.GetMatch .source -}}
  {{- if (and (eq site.Params.environment "production") (ne $resource.MediaType.SubType "svg")) -}}
    {{- printf "%s%s" site.Params.Bucket $resource.RelPermalink -}} 
  {{- else -}}
    {{- $resource.RelPermalink -}}
  {{- end -}}
{{- else -}}
  {{- errorf (printf "%s: Unable to find resource given the path:\"%s\"" .context.Position .source ) -}}
{{- end -}}
