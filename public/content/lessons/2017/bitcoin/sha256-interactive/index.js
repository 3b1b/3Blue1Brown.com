import { useState, useEffect } from "react";
import styles from "./index.module.scss";

export default function SHA256Interactive() {
  const [message, setMessage] = useState(
    "A purely peer-to-peer version of electronic cash would allow online payments to be sent directly from one party to another without going through a financial institution."
  );

  const hash = useHash(message);

  return (
    <div className={styles.app}>
      <textarea
        className={styles.input}
        rows={4}
        value={message}
        onInput={(event) => {
          setMessage(event.target.value);
        }}
      />

      <SHAArrow />

      <div className={styles.hash}>{hash}</div>
    </div>
  );
}

export function ZeroesGame() {
  const [nonce, setNonce] = useState("0");

  const messagePrefix =
    "Alice pays Bob 100 LD\nBob pays Charlie 20 LD\nCharlie pays You 50 LD\n";
  const message = messagePrefix + nonce;

  const hash = useHash(message);

  const zeroCount = (hash || "").split("1")[0].length;

  return (
    <div className={styles.app}>
      <pre className={styles.input}>
        {messagePrefix}
        <input
          className={styles.nonce}
          type="number"
          step="1"
          min="0"
          value={nonce}
          onInput={(event) => {
            setNonce(event.target.value);
          }}
        />
      </pre>

      <SHAArrow />

      <div className={styles.hash}>
        <div style={{ color: "#03fc17", fontSize: 14, marginBottom: 4 }}>
          ({zeroCount === 0 && "No zeroes"}
          {zeroCount === 1 && "1 zero"}
          {zeroCount > 1 && zeroCount < 6 && `${zeroCount} zeroes`}
          {zeroCount >= 6 && `${zeroCount} zeroes! ðŸŽ‰`})
        </div>

        <span style={{ color: "#03fc17" }}>
          {(hash || "").slice(0, zeroCount)}
        </span>
        {(hash || "").slice(zeroCount)}
      </div>
    </div>
  );
}

function useHash(message) {
  const [hash, setHash] = useState(null);
  useEffect(() => {
    let cancelled = false;
    (async () => {
      const encoder = new TextEncoder();
      const data = encoder.encode(message);
      const hashBuffer = await crypto.subtle.digest("SHA-256", data);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      const hashString = hashArray
        .map((byte) => byte.toString(2).padStart(8, "0"))
        .join("");

      if (!cancelled) {
        setHash(hashString);
      }
    })();

    return () => {
      cancelled = true;
    };
  }, [message]);

  return hash;
}

function SHAArrow() {
  return (
    <svg
      className={styles.arrow}
      width="100"
      height="auto"
      viewBox="0 0 144 181"
      version="1.1"
    >
      <g transform="matrix(1,0,0,1,-161.814,-7.10272)">
        <g transform="matrix(1,-0,-0,1,161.814,7.10272)">
          <path
            d="M80.49,137.336L71.49,155.336L62.49,137.336C66.99,141.836 75.99,141.836 80.49,137.336Z"
            style={{ fill: "rgb(255,201,0)" }}
          />
          <path
            d="M71.49,25.456L71.49,140.936"
            style={{ fill: "none", stroke: "rgb(255,201,0)", strokeWidth: 4 }}
          />
        </g>
      </g>
      <g transform="matrix(0.993168,0,0,1.04551,-160.515,-10.8215)">
        <rect
          x="161.619"
          y="73.031"
          width="144.711"
          height="40.613"
          style={{ fill: "black" }}
        />
      </g>
      <g transform="matrix(1,0,0,1,-43.3061,37.702)" style={{ fill: "white" }}>
        <g transform="matrix(36,0,0,36,51.46,61.5061)">
          <path d="M0.056,-0.002L0.056,-0.202C0.056,-0.21 0.056,-0.215 0.057,-0.217C0.057,-0.22 0.058,-0.222 0.06,-0.224C0.062,-0.226 0.065,-0.227 0.069,-0.227C0.076,-0.227 0.08,-0.224 0.081,-0.217C0.083,-0.151 0.104,-0.099 0.143,-0.063C0.182,-0.027 0.234,-0.009 0.301,-0.009C0.341,-0.009 0.373,-0.023 0.398,-0.052C0.423,-0.081 0.435,-0.114 0.435,-0.152C0.435,-0.188 0.425,-0.219 0.404,-0.244C0.395,-0.256 0.385,-0.265 0.374,-0.272C0.363,-0.28 0.355,-0.284 0.348,-0.287C0.341,-0.289 0.332,-0.292 0.319,-0.295C0.236,-0.315 0.192,-0.326 0.187,-0.328C0.148,-0.341 0.116,-0.365 0.092,-0.399C0.068,-0.432 0.056,-0.47 0.056,-0.511C0.056,-0.565 0.075,-0.61 0.113,-0.648C0.15,-0.686 0.196,-0.705 0.251,-0.705C0.278,-0.705 0.303,-0.701 0.326,-0.692C0.349,-0.684 0.366,-0.675 0.375,-0.667C0.384,-0.66 0.396,-0.649 0.411,-0.635L0.446,-0.692C0.451,-0.701 0.456,-0.705 0.461,-0.705C0.466,-0.705 0.469,-0.704 0.47,-0.7C0.472,-0.697 0.472,-0.691 0.472,-0.681L0.472,-0.48C0.472,-0.472 0.472,-0.467 0.472,-0.465C0.471,-0.462 0.47,-0.46 0.468,-0.458C0.466,-0.457 0.463,-0.456 0.459,-0.456C0.452,-0.456 0.448,-0.46 0.447,-0.468C0.428,-0.607 0.363,-0.677 0.252,-0.677C0.214,-0.677 0.182,-0.664 0.157,-0.638C0.133,-0.613 0.12,-0.582 0.12,-0.546C0.12,-0.517 0.129,-0.49 0.147,-0.466C0.166,-0.442 0.19,-0.426 0.221,-0.419L0.349,-0.388C0.392,-0.378 0.427,-0.354 0.456,-0.316C0.485,-0.279 0.499,-0.235 0.499,-0.186C0.499,-0.129 0.481,-0.081 0.444,-0.04C0.407,0.001 0.359,0.022 0.302,0.022C0.26,0.022 0.224,0.015 0.192,0.001C0.16,-0.012 0.135,-0.029 0.118,-0.048C0.105,-0.026 0.094,-0.008 0.085,0.004L0.082,0.009C0.077,0.018 0.072,0.022 0.067,0.022C0.062,0.022 0.059,0.02 0.058,0.017C0.057,0.014 0.056,0.007 0.056,-0.002Z" />
        </g>
        <g transform="matrix(36,0,0,36,71.4288,61.5061)">
          <path d="M0.033,-0L0.033,-0.031L0.057,-0.031C0.093,-0.031 0.115,-0.034 0.124,-0.04C0.132,-0.046 0.136,-0.059 0.136,-0.078L0.136,-0.605C0.136,-0.624 0.132,-0.637 0.124,-0.643C0.115,-0.649 0.093,-0.652 0.057,-0.652L0.033,-0.652L0.033,-0.683C0.057,-0.681 0.106,-0.68 0.181,-0.68C0.256,-0.68 0.305,-0.681 0.328,-0.683L0.328,-0.652L0.304,-0.652C0.268,-0.652 0.246,-0.649 0.238,-0.643C0.229,-0.637 0.225,-0.624 0.225,-0.605L0.225,-0.371L0.524,-0.371L0.524,-0.605C0.524,-0.624 0.52,-0.637 0.511,-0.643C0.503,-0.649 0.481,-0.652 0.445,-0.652L0.421,-0.652L0.421,-0.683C0.444,-0.681 0.494,-0.68 0.569,-0.68C0.643,-0.68 0.692,-0.681 0.716,-0.683L0.716,-0.652L0.692,-0.652C0.656,-0.652 0.634,-0.649 0.625,-0.643C0.617,-0.637 0.613,-0.624 0.613,-0.605L0.613,-0.078C0.613,-0.059 0.617,-0.046 0.625,-0.04C0.634,-0.034 0.656,-0.031 0.692,-0.031L0.716,-0.031L0.716,-0C0.692,-0.002 0.643,-0.003 0.568,-0.003C0.493,-0.003 0.444,-0.002 0.421,-0L0.421,-0.031L0.445,-0.031C0.481,-0.031 0.503,-0.034 0.511,-0.04C0.52,-0.046 0.524,-0.059 0.524,-0.078L0.524,-0.34L0.225,-0.34L0.225,-0.078C0.225,-0.059 0.229,-0.046 0.238,-0.04C0.246,-0.034 0.268,-0.031 0.304,-0.031L0.328,-0.031L0.328,-0C0.305,-0.002 0.255,-0.003 0.18,-0.003C0.106,-0.003 0.057,-0.002 0.033,-0Z" />
        </g>
        <g transform="matrix(36,0,0,36,98.4288,61.5061)">
          <path d="M0.032,-0L0.032,-0.031C0.091,-0.032 0.129,-0.055 0.144,-0.098L0.351,-0.696C0.354,-0.704 0.356,-0.709 0.359,-0.712C0.362,-0.715 0.368,-0.716 0.375,-0.716C0.379,-0.716 0.382,-0.715 0.385,-0.715C0.387,-0.714 0.389,-0.713 0.391,-0.71C0.392,-0.708 0.393,-0.706 0.394,-0.705C0.395,-0.704 0.396,-0.701 0.398,-0.696L0.614,-0.071C0.619,-0.054 0.627,-0.043 0.638,-0.038C0.648,-0.033 0.669,-0.031 0.699,-0.031L0.717,-0.031L0.717,-0C0.675,-0.002 0.631,-0.003 0.586,-0.003C0.514,-0.003 0.466,-0.002 0.442,-0L0.442,-0.031C0.497,-0.031 0.525,-0.041 0.525,-0.061C0.525,-0.062 0.524,-0.067 0.522,-0.075L0.469,-0.228L0.222,-0.228L0.176,-0.097C0.174,-0.095 0.174,-0.09 0.174,-0.082C0.174,-0.068 0.18,-0.056 0.193,-0.046C0.206,-0.036 0.225,-0.031 0.249,-0.031L0.249,-0C0.185,-0.002 0.146,-0.003 0.134,-0.003C0.112,-0.003 0.078,-0.002 0.032,-0ZM0.233,-0.259L0.458,-0.259L0.345,-0.584L0.233,-0.259Z" />
        </g>
        <g transform="matrix(36,0,0,36,125.429,61.5061)">
          <path d="M0.05,-0C0.05,-0.012 0.05,-0.02 0.052,-0.023C0.053,-0.027 0.056,-0.032 0.061,-0.037L0.253,-0.251C0.323,-0.33 0.358,-0.403 0.358,-0.472C0.358,-0.517 0.346,-0.555 0.323,-0.587C0.3,-0.619 0.267,-0.635 0.224,-0.635C0.195,-0.635 0.168,-0.626 0.143,-0.608C0.118,-0.59 0.1,-0.565 0.089,-0.533C0.091,-0.534 0.095,-0.534 0.102,-0.534C0.119,-0.534 0.132,-0.529 0.141,-0.519C0.15,-0.508 0.155,-0.496 0.155,-0.482C0.155,-0.464 0.149,-0.451 0.137,-0.442C0.126,-0.434 0.114,-0.429 0.103,-0.429C0.098,-0.429 0.093,-0.43 0.087,-0.431C0.081,-0.432 0.073,-0.437 0.064,-0.446C0.055,-0.455 0.05,-0.468 0.05,-0.485C0.05,-0.531 0.067,-0.573 0.103,-0.61C0.138,-0.647 0.183,-0.666 0.237,-0.666C0.298,-0.666 0.349,-0.648 0.389,-0.612C0.429,-0.575 0.449,-0.529 0.449,-0.472C0.449,-0.452 0.446,-0.433 0.44,-0.415C0.434,-0.397 0.427,-0.381 0.419,-0.367C0.411,-0.353 0.396,-0.335 0.375,-0.313C0.354,-0.29 0.334,-0.271 0.317,-0.255C0.3,-0.239 0.272,-0.214 0.233,-0.18L0.127,-0.077L0.307,-0.077C0.366,-0.077 0.397,-0.08 0.402,-0.085C0.408,-0.094 0.416,-0.124 0.424,-0.174L0.449,-0.174L0.421,-0L0.05,-0Z" />
        </g>
        <g transform="matrix(36,0,0,36,143.429,61.5061)">
          <path d="M0.05,-0.161C0.05,-0.181 0.055,-0.195 0.066,-0.202C0.077,-0.21 0.088,-0.214 0.099,-0.214C0.114,-0.214 0.127,-0.209 0.135,-0.199C0.144,-0.19 0.149,-0.178 0.149,-0.165C0.149,-0.152 0.144,-0.14 0.135,-0.131C0.127,-0.121 0.114,-0.116 0.099,-0.116C0.092,-0.116 0.086,-0.117 0.082,-0.118C0.091,-0.088 0.109,-0.061 0.135,-0.039C0.162,-0.017 0.194,-0.006 0.229,-0.006C0.274,-0.006 0.309,-0.028 0.336,-0.071C0.352,-0.099 0.36,-0.145 0.36,-0.208C0.36,-0.264 0.354,-0.306 0.342,-0.334C0.323,-0.377 0.295,-0.398 0.257,-0.398C0.203,-0.398 0.16,-0.375 0.128,-0.328C0.124,-0.322 0.12,-0.319 0.115,-0.319C0.109,-0.319 0.105,-0.321 0.103,-0.324C0.102,-0.328 0.101,-0.335 0.101,-0.345L0.101,-0.641C0.101,-0.657 0.104,-0.665 0.111,-0.665C0.113,-0.665 0.118,-0.664 0.123,-0.662C0.165,-0.644 0.209,-0.634 0.256,-0.634C0.304,-0.634 0.349,-0.644 0.392,-0.663C0.395,-0.665 0.398,-0.666 0.4,-0.666C0.406,-0.666 0.41,-0.662 0.41,-0.655C0.41,-0.652 0.407,-0.647 0.402,-0.639C0.397,-0.632 0.388,-0.623 0.377,-0.613C0.366,-0.603 0.353,-0.593 0.338,-0.584C0.323,-0.575 0.305,-0.567 0.284,-0.56C0.263,-0.554 0.24,-0.551 0.217,-0.551C0.189,-0.551 0.16,-0.555 0.132,-0.564L0.132,-0.369C0.166,-0.403 0.209,-0.42 0.259,-0.42C0.312,-0.42 0.357,-0.398 0.394,-0.355C0.431,-0.313 0.449,-0.261 0.449,-0.201C0.449,-0.138 0.427,-0.085 0.384,-0.042C0.341,0 0.29,0.022 0.231,0.022C0.178,0.022 0.134,0.003 0.1,-0.035C0.067,-0.073 0.05,-0.115 0.05,-0.161Z" />
        </g>
        <g transform="matrix(36,0,0,36,161.429,61.5061)">
          <path d="M0.042,-0.316C0.042,-0.421 0.069,-0.505 0.122,-0.57C0.175,-0.634 0.236,-0.666 0.305,-0.666C0.345,-0.666 0.376,-0.656 0.399,-0.635C0.421,-0.615 0.432,-0.589 0.432,-0.558C0.432,-0.541 0.427,-0.528 0.417,-0.521C0.407,-0.514 0.397,-0.51 0.386,-0.51C0.374,-0.51 0.363,-0.514 0.354,-0.522C0.345,-0.53 0.34,-0.542 0.34,-0.556C0.34,-0.586 0.358,-0.601 0.395,-0.601C0.378,-0.628 0.348,-0.641 0.307,-0.641C0.294,-0.641 0.282,-0.639 0.269,-0.635C0.256,-0.632 0.241,-0.624 0.224,-0.611C0.207,-0.599 0.192,-0.583 0.179,-0.563C0.166,-0.544 0.155,-0.516 0.146,-0.479C0.136,-0.442 0.132,-0.4 0.132,-0.352L0.132,-0.328C0.159,-0.394 0.201,-0.427 0.257,-0.427C0.313,-0.427 0.36,-0.405 0.399,-0.363C0.438,-0.32 0.457,-0.267 0.457,-0.204C0.457,-0.139 0.437,-0.085 0.396,-0.042C0.356,0 0.308,0.022 0.251,0.022C0.226,0.022 0.201,0.017 0.178,0.006C0.156,-0.004 0.133,-0.022 0.112,-0.046C0.091,-0.07 0.074,-0.105 0.061,-0.151C0.048,-0.198 0.042,-0.252 0.042,-0.316ZM0.134,-0.226C0.134,-0.161 0.14,-0.112 0.152,-0.081C0.154,-0.076 0.157,-0.07 0.161,-0.063C0.166,-0.055 0.172,-0.047 0.179,-0.038C0.187,-0.029 0.197,-0.021 0.21,-0.015C0.223,-0.009 0.236,-0.006 0.251,-0.006C0.296,-0.006 0.329,-0.028 0.35,-0.071C0.361,-0.095 0.367,-0.14 0.367,-0.205C0.367,-0.272 0.361,-0.317 0.349,-0.342C0.329,-0.383 0.298,-0.404 0.256,-0.404C0.228,-0.404 0.204,-0.394 0.185,-0.375C0.165,-0.356 0.152,-0.333 0.145,-0.308C0.137,-0.282 0.134,-0.255 0.134,-0.226Z" />
        </g>
      </g>
    </svg>
  );
}
